<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>http 요청과 응답</title>
</head>

<body>

    <button id="load">서버에서 회원정보 불러오기</button>

    <ul class="content"></ul>

    <script>
        //서버가 응답한 정보를 화면에 렌더링
        let makeResultDOM = (response) => {
            /*
                서버가 응답한 데이터는 마치 자바스크립트의 객체, 배열 형태로 보이지만 사실은 아닙니다.
                이런 형태의 데이터를 JSON이라고 부릅니다.

                JSON은 자바스크립트가 아닌 독립적 데이터 포맷이기 때문에 사용하려면 자바스크립트로 변환해서 써야합니다.

                # json -> js :    JSON.parse()
                  js -> json :    JSON.stringify()
            */
            const userList = JSON.parse(response);

            const $ul = document.querySelector('.content');
            for (let user of userList) {
                const {account, userName, address} = user;
                const $li = document.createElement('li');
                $li.textContent = `# 아이디 : ${account}, 이름: ${userName}, 주소: ${address}`;

                $ul.appendChild($li);
            }
        }


        let $button = document.querySelector('#load');
        $button.addEventListener('click', e => {

            // # http 요청을 서버로 보내는 방법 
            //1. XMLHttpRequest 객체를 생성
            const xhr = new XMLHttpRequest();

            //2. http 요청 설정 (요청방식, 요청URL
            /*
            - 요청 방식: 
            a. GET - 조회 ex , 회원정보조회, 댓글보기
            b. POST - 등록 ex 회원가입, 댓글쓰기
            c. PUT - 수정 ex 회원정보변경, 댓글수정
            d. DELETE - 삭제 ex 회원탈퇴 댓글삭제
            */
            xhr.open('GET', 'http://localhost:5000/user');

            //3. http 요청 전송
            xhr.send();

        //4. 응답정보 확인 -> 외워두면 좋은거
        // 200(성공): 서버가 요청을 제대로 처리했다는 뜻이다. 이는 주로 서버가 요청한 페이지를 제공했다는 의미로 쓰인다.
        // 201(작성됨): 성공적으로 요청되었으며 서버가 새 리소스를 작성했다. 
        // 307(임시 리다이렉션): 현재 서버가 다른 위치의 페이지로 요청에 응답하고 있지만 요청자는 향후 요청 시 원래 위치를 계속 사용해야 한다.
        // 403(Forbidden, 금지됨): 서버가 요청을 거부하고 있다. 예를 들자면, 사용자가 리소스에 대한 필요 권한을 갖고 있지 않다. (401은 인증 실패, 403은 인가 실패라고 볼 수 있음)
        // 404(Not Found, 찾을 수 없음): 서버가 요청한 페이지(Resource)를 찾을 수 없다. 예를 들어 서버에 존재하지 않는 페이지에 대한 요청이 있을 경우 서버는 이 코드를 제공한다.
        // 405(허용되지 않는 메소드): 요청에 지정된 방법을 사용할 수 없다. 예를 들어 POST 방식으로 요청을 받는 서버에 GET 요청을 보내는 경우, 또는 읽기 전용 리소스에 PUT 요청을 보내는 경우에 이 코드를 제공한다.
            xhr.onload = e => {
                console.log(xhr.status); //응답코드
                if (xhr.status === 200) {
                    makeResultDOM(xhr.response);
                } else {
                    console.error('통신 실패!');
                }
            };

            
        });
    </script>

</body>

</html>